# 需求文档

## 简介

本功能为 WebAR 粒子交互系统提供无摄像头降级处理方案。当用户设备没有摄像头或摄像头不可用时，系统应能正常进入主页并提供一个手势模拟器控制面板，允许用户通过键盘和 UI 控件来模拟手势交互，体验粒子形态变换效果。

## 术语表

- **手势模拟器 (Gesture_Simulator)**: 一个 UI 控制面板，用于在无摄像头情况下模拟手势操作
- **形态按钮 (Shape_Button)**: 用于触发粒子系统切换到特定形态的 UI 按钮
- **降级模式 (Fallback_Mode)**: 当摄像头不可用时系统进入的备用运行模式
- **键盘控制 (Keyboard_Control)**: 使用方向键控制粒子形态旋转的交互方式
- **缩放滑块 (Scale_Slider)**: 用于模拟手势远近效果的进度条控件
- **形态类型 (ShapeType)**: 粒子系统支持的各种形状（行星、文字、圆环、星形、爱心、一箭穿心）
- **粒子画布 (ParticleCanvas)**: 管理 Three.js 场景和粒子渲染的核心组件

## 需求

### 需求 1

**用户故事:** 作为一个没有摄像头的用户，我希望应用能够优雅降级并允许我进入主页，以便我可以在没有摄像头硬件的情况下体验粒子效果。

#### 验收标准

1. WHEN 摄像头不可用或权限被拒绝 THEN 粒子画布 SHALL 在不阻塞摄像头初始化的情况下初始化渲染引擎和物理引擎
2. WHEN 摄像头初始化失败 THEN 粒子画布 SHALL 自动显示手势模拟器面板
3. WHEN 系统进入降级模式 THEN 粒子画布 SHALL 成功渲染默认粒子形态（行星）
4. WHEN 初始失败后摄像头变为可用 THEN 系统 SHALL 提供重试摄像头初始化的选项

### 需求 2

**用户故事:** 作为用户，我希望有一个带有形态按钮的手势模拟器面板，以便我可以手动触发粒子形态变换而无需使用手势。

#### 验收标准

1. WHEN 手势模拟器面板显示时 THEN 系统 SHALL 为每个可用的形态类型显示形态按钮元素
2. WHEN 向 ShapeGenerator 添加新的形态类型时 THEN 手势模拟器 SHALL 动态加载新的形态按钮而无需修改代码
3. WHEN 用户点击形态按钮 THEN 系统 SHALL 触发相应的粒子形态转换并带有爆炸效果
4. WHEN 形态转换正在进行时 THEN 形态按钮元素 SHALL 指示当前活动的形态

### 需求 3

**用户故事:** 作为用户，我希望使用键盘方向键控制粒子旋转，以便我可以模拟手部旋转手势。

#### 验收标准

1. WHEN 用户按下上方向键 THEN 系统 SHALL 围绕 X 轴向上旋转粒子形态
2. WHEN 用户按下下方向键 THEN 系统 SHALL 围绕 X 轴向下旋转粒子形态
3. WHEN 用户按下左方向键 THEN 系统 SHALL 围绕 Y 轴向左旋转粒子形态
4. WHEN 用户按下右方向键 THEN 系统 SHALL 围绕 Y 轴向右旋转粒子形态
5. WHEN 同时按下多个方向键 THEN 系统 SHALL 应用组合旋转变换

### 需求 4

**用户故事:** 作为用户，我希望有一个缩放滑块来控制粒子形态大小，以便我可以模拟手势的深度/距离效果。

#### 验收标准

1. WHEN 手势模拟器面板显示时 THEN 系统 SHALL 显示缩放滑块控件
2. WHEN 用户调整缩放滑块 THEN 系统 SHALL 按比例更新粒子形态缩放
3. WHEN 缩放滑块值变化时 THEN 系统 SHALL 对缩放过渡应用平滑插值
4. WHEN 缩放达到最小或最大边界时 THEN 缩放滑块 SHALL 阻止在该方向上的进一步调整

### 需求 5

**用户故事:** 作为用户，我希望手势模拟器能与摄像头模式共存，以便即使摄像头可用时我也可以使用手动控制。

#### 验收标准

1. WHEN 摄像头可用且活动时 THEN 系统 SHALL 提供显示手势模拟器面板的选项
2. WHEN 摄像头和手势模拟器同时活动时 THEN 手动控制 SHALL 临时覆盖摄像头检测的手势
3. WHEN 用户关闭手势模拟器面板 THEN 系统 SHALL 恢复基于摄像头的手势检测

### 需求 6

**用户故事:** 作为开发者，我希望形态按钮从 ShapeType 枚举动态生成，以便添加新形态时只需最少的代码更改。

#### 验收标准

1. WHEN 手势模拟器初始化时 THEN 系统 SHALL 枚举 ShapeType 枚举的所有值
2. WHEN 渲染形态按钮元素时 THEN 系统 SHALL 使用映射配置来设置按钮标签和图标
3. WHEN 某个形态类型值没有映射配置时 THEN 系统 SHALL 使用枚举值作为默认标签
