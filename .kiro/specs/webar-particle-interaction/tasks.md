# 实现计划

- [x] 1. 项目初始化和基础设施搭建





  - 使用 Vite 创建 React + TypeScript 项目
  - 配置 Vitest 和 fast-check 测试框架
  - 创建项目目录结构（components, engines, shapes, utils）
  - 配置 TypeScript 编译选项
  - _需求: 14.1_

- [x] 2. 实现外部库加载器





  - 创建 LibraryLoader 类，支持从 unpkg CDN 动态加载脚本
  - 实现 Three.js 加载和验证逻辑
  - 实现 MediaPipe Hands 加载和验证逻辑
  - 实现加载失败的错误处理和用户提示
  - _需求: 1.1, 2.1, 15.1, 15.2, 15.3, 15.4, 15.5_

- [x] 2.1 编写库加载器单元测试


  - 测试成功加载场景
  - 测试加载失败错误处理
  - 测试库验证逻辑
  - _需求: 15.2, 15.3, 15.4_

- [x] 3. 实现粒子数据结构和物理引擎核心





  - 创建 Particle 接口，定义位置、速度、加速度、目标位置、颜色属性
  - 创建 ParticleData 类，使用 Float32Array 存储 16,000 个粒子数据
  - 实现粒子初始化方法，设置青色初始颜色
  - 实现基础物理更新方法：速度积分更新位置（p = p + v*dt）
  - 实现基础物理更新方法：加速度积分更新速度（v = v + a*dt）
  - _需求: 1.2, 1.3, 1.4, 3.1, 3.2_

- [x] 3.1 编写粒子初始化属性测试


  - **属性 1: 粒子系统初始化完整性**
  - **验证需求: 1.2, 1.3, 1.4**

- [x] 3.2 编写速度积分属性测试


  - **属性 2: 速度积分更新位置**
  - **验证需求: 3.1**

- [x] 3.3 编写加速度积分属性测试


  - **属性 3: 加速度积分更新速度**
  - **验证需求: 3.2**

- [x] 4. 实现物理引擎的力和加速度系统





  - 实现 applyForce 方法，根据 F=ma 计算加速度
  - 实现阻尼系统，使粒子接近目标时减速
  - 实现目标吸引力，驱动粒子向目标位置移动
  - 实现爆炸力系统，对所有粒子施加径向外力
  - 配置物理参数（阻尼系数、最大速度、吸引力强度等）
  - _需求: 3.3, 3.5, 10.2, 10.3_

- [x] 4.1 编写力应用属性测试


  - **属性 4: 力正确应用为加速度**
  - **验证需求: 3.3**

- [x] 4.2 编写阻尼效果属性测试


  - **属性 5: 阻尼减速效果**
  - **验证需求: 3.5**

- [x] 4.3 编写爆炸力属性测试


  - **属性 16: 状态转换触发爆炸**
  - **验证需求: 10.1, 10.2, 10.3**

- [x] 4.4 编写重组吸引力属性测试


  - **属性 17: 爆炸后重组吸引**
  - **验证需求: 10.5**

- [x] 5. 实现形状生成器 - 行星（球体）





  - 创建 ShapeGenerator 类
  - 实现 generatePlanet 方法，使用球面均匀采样算法生成球体位置
  - 实现金蓝色渐变着色逻辑（基于球面坐标或高度）
  - 确保生成的点数量与输入粒子数量一致
  - _需求: 4.1, 4.2_

- [x] 5.1 编写行星生成属性测试


  - **属性 6: 行星形状生成**
  - **验证需求: 4.1**

- [x] 5.2 编写行星着色属性测试


  - **属性 7: 行星金蓝渐变着色**
  - **验证需求: 4.2**

- [x] 6. 实现形状生成器 - 文字





  - 实现 generateText 方法，使用 Canvas API 渲染"我是ai"文字
  - 从 Canvas 提取像素数据，识别非透明像素位置
  - 实现粒子采样算法，将粒子均匀分配到文字像素点
  - 处理粒子数量与像素点数量不匹配的情况
  - _需求: 5.1, 5.2_

- [x] 6.1 编写文字粒子分配属性测试

  - **属性 10: 文字形状粒子分配**
  - **验证需求: 5.2**

- [x] 7. 实现形状生成器 - 圆环（环面）





  - 实现 generateTorus 方法，使用环面参数方程生成位置
  - 配置内半径和外半径参数
  - 实现均匀采样策略，确保粒子在环面上均匀分布
  - _需求: 6.1, 6.3, 6.5_

- [ ] 7.1 编写圆环几何属性测试

  - **属性 11: 圆环形状几何约束**

  - **验证需求: 6.1, 6.3**

- [ ] 7.2 编写圆环分布属性测试

  - **属性 12: 圆环均匀分布**

  - **验证需求: 6.5**

- [x] 8. 实现形状生成器 - 五角星





  - 实现 generateStar 方法，计算五角星的顶点和边界
  - 实现星形内部和轮廓的粒子填充算法
  - 确保五个尖角区域清晰可见
  - _需求: 7.1, 7.5_

- [ ] 8.1 编写星形生成属性测试
  - **属性 13: 星形生成**
  - **验证需求: 7.1**

- [x] 9. 实现形状生成器 - 心形





  - 实现 generateHeart 方法，使用心形参数方程生成位置
  - 实现心形区域填充算法
  - 确保所有点都在心形数学定义的区域内
  - _需求: 8.1, 8.5_

- [x] 9.1 编写心形区域属性测试


  - **属性 14: 心形区域填充**
  - **验证需求: 8.1, 8.5**

- [x] 10. 实现形状生成器 - 一箭穿心





  - 实现 generateArrowHeart 方法，生成心形和箭矢两部分粒子位置
  - 设计箭矢的几何形状（箭头 + 箭杆）
  - 实现箭矢穿过心形的位置布局
  - 实现粉色着色逻辑
  - _需求: 9.1, 9.2_

- [x] 10.1 编写比心粉色着色属性测试


  - **属性 15: 比心粉色着色**
  - **验证需求: 9.1**

- [x] 11. 实现 Three.js 渲染引擎





  - 创建 ThreeEngine 类
  - 初始化 Scene, Camera, WebGLRenderer
  - 创建 BufferGeometry 和 Points 材质用于粒子渲染
  - 实现 render 方法，每帧渲染场景
  - 实现 resize 方法，处理窗口大小变化
  - 实现 dispose 方法，清理 WebGL 资源
  - 监听 WebGL 上下文丢失和恢复事件
  - _需求: 1.2, 1.5_

- [x] 11.1 编写渲染引擎单元测试


  - 测试场景初始化
  - 测试资源清理
  - 测试窗口调整
  - _需求: 1.2_

- [x] 12. 实现摄像头管理器





  - 创建 CameraManager 类
  - 实现 requestCamera 方法，请求用户摄像头权限
  - 处理权限拒绝、设备未找到等错误情况
  - 配置视频流参数（分辨率 1280x720）
  - _需求: 2.2, 2.3_

- [ ] 12.1 编写摄像头管理器单元测试
  - 测试权限请求
  - 测试错误处理
  - _需求: 2.2, 2.3_

- [x] 13. 实现手势识别引擎基础





  - 创建 GestureEngine 类
  - 集成 MediaPipe Hands，初始化手部检测模型
  - 实现 update 方法，处理视频帧并获取手部关键点
  - 实现节流机制，降低 MediaPipe 处理频率（20 FPS）
  - 处理无手部检测的情况
  - _需求: 2.4, 2.5_

- [x] 13.1 编写手势引擎初始化单元测试


  - 测试 MediaPipe 初始化
  - 测试节流机制
  - _需求: 2.4_

- [x] 14. 实现手部数据提取





  - 实现 extractHandData 方法，从 MediaPipe 关键点提取手部中心位置
  - 实现手部速度计算，基于位置历史（位置差 / 时间差）
  - 实现手掌画面占比计算，基于手部边界框面积
  - 实现手部旋转角度计算，基于手掌平面法向量
  - _需求: 2.5, 11.1, 12.1, 16.1, 16.2_

- [x] 14.1 编写手部速度计算属性测试


  - **属性 18: 手部速度计算**
  - **验证需求: 11.1**

- [x] 14.2 编写手部旋转计算属性测试


  - **属性 23: 手部旋转计算**
  - **验证需求: 16.1, 16.2**

- [x] 15. 实现手势分类器





  - 实现 analyzeFingerStates 方法，判断每个手指的伸展状态
  - 实现 detectGesture 方法，根据手指状态分类手势
  - 实现张手手势识别（五指张开）
  - 实现剪刀手手势识别（食指和中指伸展）
  - 实现握拳手势识别（所有手指收起）
  - 实现食指手势识别（仅食指伸展）
  - 实现竖大拇指手势识别（仅大拇指伸展）
  - 实现手指比心手势识别（食指和大拇指形成心形）
  - _需求: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7_

- [x] 15.1 编写手指状态分析属性测试


  - **属性 22: 手指状态分析**
  - **验证需求: 13.1**


- [x] 15.2 编写手势识别单元测试

  - 测试张手识别
  - 测试剪刀手识别
  - 测试握拳识别
  - 测试食指识别
  - 测试竖大拇指识别
  - 测试手指比心识别
  - _需求: 13.2, 13.3, 13.4, 13.5, 13.6, 13.7_

- [x] 16. 实现手势状态机




  - 创建 GestureStateMachine 类
  - 实现状态转换检测，识别手势变化
  - 实现过渡状态管理，跟踪过渡时间
  - 实现状态变化回调，触发粒子系统响应
  - _需求: 10.1_

- [x] 16.1 编写状态机单元测试

  - 测试状态转换检测
  - 测试过渡状态管理
  - _需求: 10.1_

- [-] 17. 实现交互管理器 - 挥手风暴


  - 创建 InteractionManager 类
  - 实现 checkWaveStorm 方法，检测手部速度是否超过阈值
  - 实现 applyWaveForce 方法，对范围内粒子施加风暴力
  - 实现力的距离衰减算法（距离越远力越小）
  - 配置挥手风暴参数（速度阈值、力强度、影响半径）
  - _需求: 11.2, 11.3, 11.4, 11.5_

- [ ] 17.1 编写挥手风暴属性测试
  - **属性 19: 挥手风暴触发和力施加**
  - **验证需求: 11.2, 11.3, 11.4, 11.5**

- [ ] 18. 实现交互管理器 - 深度推拉反馈
  - 实现 updateScale 方法，根据手掌占比计算缩放比例
  - 实现缩放平滑过渡，避免突变
  - 配置缩放范围（最小 0.5，最大 2.0）
  - 确保缩放保持形状相对比例不变
  - _需求: 12.2, 12.3, 12.4, 12.5_

- [ ] 18.1 编写深度推拉属性测试
  - **属性 20: 手掌占比与缩放正相关**
  - **验证需求: 12.1, 12.2, 12.3, 12.4**

- [ ] 18.2 编写缩放比例保持属性测试
  - **属性 21: 缩放保持形状比例**
  - **验证需求: 12.5**

- [ ] 19. 实现交互管理器 - 爆炸过渡特效
  - 实现 triggerTransition 方法，触发状态切换时的爆炸效果
  - 实现爆炸力施加，对所有粒子施加径向外力
  - 实现过渡时序控制，先爆炸扩散再重组
  - 实现新形状目标位置的动态更新
  - 配置爆炸参数（力强度、持续时间）
  - _需求: 4.5, 5.4, 6.4, 7.4, 8.4, 10.2, 10.3, 10.4, 10.5_

- [ ] 19.1 编写爆炸过渡单元测试
  - 测试爆炸触发
  - 测试过渡时序
  - _需求: 10.2, 10.4_

- [ ] 20. 实现行星状态的位置和旋转跟随
  - 在物理引擎中实现行星跟随手部中心位置
  - 实现行星旋转跟随手部旋转角度
  - 实现行星倾斜跟随手部倾斜
  - 确保旋转变换后行星形状完整性
  - _需求: 4.3, 4.4, 16.3, 16.4, 16.5_

- [ ] 20.1 编写行星位置跟随属性测试
  - **属性 8: 行星位置跟随手部**
  - **验证需求: 4.3**

- [ ] 20.2 编写行星旋转跟随属性测试
  - **属性 9: 行星旋转跟随手部**
  - **验证需求: 4.4, 16.2, 16.3**

- [ ] 20.3 编写行星形状完整性属性测试
  - **属性 24: 行星形状完整性**
  - **验证需求: 16.5**

- [ ] 21. 实现手指比心散开效果
  - 在状态机中检测从手指比心到张手的转换
  - 触发粉色粒子爆炸散开效果
  - 实现颜色从粉色恢复到青色的过渡
  - 实现粒子返回默认状态
  - _需求: 9.4, 9.5_

- [ ] 21.1 编写比心散开单元测试
  - 测试状态转换检测
  - 测试颜色恢复
  - _需求: 9.4, 9.5_

- [ ] 22. 创建 ParticleCanvas React 组件
  - 创建 ParticleCanvas 组件，作为 Three.js 场景容器
  - 在 useEffect 中初始化 Three.js 引擎
  - 在 useEffect 中初始化物理引擎
  - 在 useEffect 中初始化手势引擎
  - 实现组件卸载时的资源清理
  - 设置 canvas 元素的样式和尺寸
  - _需求: 14.2, 14.3_

- [ ] 22.1 编写 ParticleCanvas 组件测试
  - 测试组件挂载和初始化
  - 测试组件卸载和清理
  - _需求: 14.2, 14.3_

- [ ] 23. 实现主渲染循环
  - 在 ParticleCanvas 中创建 requestAnimationFrame 循环
  - 每帧调用手势引擎更新，获取最新手部数据
  - 每帧调用状态机更新，检测手势变化
  - 每帧调用交互管理器，处理挥手风暴和深度推拉
  - 每帧调用物理引擎更新，计算粒子位置
  - 每帧更新 Three.js 几何体的位置和颜色属性
  - 每帧调用 Three.js 渲染
  - 计算 deltaTime 用于物理模拟
  - _需求: 1.5, 3.1, 3.2_

- [ ] 23.1 编写渲染循环单元测试
  - 测试循环启动和停止
  - 测试 deltaTime 计算
  - _需求: 1.5_

- [ ] 24. 创建 App 根组件
  - 创建 App 组件作为应用入口
  - 实现库加载状态管理（loading, error, loaded）
  - 在组件挂载时调用 LibraryLoader 加载外部库
  - 显示加载中 UI（加载指示器）
  - 显示错误 UI（错误信息和重试按钮）
  - 库加载成功后渲染 ParticleCanvas 组件
  - _需求: 15.5_

- [ ] 24.1 编写 App 组件测试
  - 测试加载状态管理
  - 测试错误处理 UI
  - _需求: 15.5_

- [ ] 25. 实现性能监控和降级
  - 创建 PerformanceMonitor 类
  - 实现 FPS 计算和监控
  - 实现性能降级策略（FPS < 20 时触发）
  - 可选降级措施：减少粒子数量、降低手势检测频率
  - _需求: 17.1_

- [ ] 25.1 编写性能监控单元测试
  - 测试 FPS 计算
  - 测试降级触发
  - _需求: 17.1_

- [ ] 26. 添加 UI 控制层（可选）
  - 创建简单的 UI 控件显示当前手势状态
  - 添加粒子数量调整滑块（用于性能测试）
  - 添加手势识别调试信息显示
  - 添加 FPS 显示
  - _需求: 无（增强功能）_

- [ ] 27. 优化和调试
  - 调整物理参数以获得最佳视觉效果
  - 调整形状生成参数以确保清晰可见
  - 调整颜色和渲染参数以提升视觉质量
  - 测试所有手势切换的流畅性
  - 测试挥手风暴和深度推拉的响应性
  - 在不同浏览器和设备上测试兼容性
  - _需求: 所有需求_

- [ ] 28. 最终检查点 - 确保所有测试通过
  - 运行所有单元测试，确保通过
  - 运行所有属性测试，确保通过
  - 手动测试所有手势交互
  - 验证所有需求都已实现
  - 如有问题，询问用户
;.  - _需求: 所有需求_
